<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="SellPhoneApplication.Views.OrderManagementPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:models="clr-namespace:SellPhoneApplication.Models"
    xmlns:shared="clr-namespace:SellPhoneApplication.Shared"
    x:Name="OrderManagementPageView"
    BackgroundColor="#F8F8F8"
    Shell.FlyoutBehavior="Disabled">

    <Grid RowSpacing="0">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <!--  Header  -->
            <RowDefinition Height="Auto" />

            <RowDefinition Height="Auto" />
            <!--  Title & Add button  -->
            <RowDefinition Height="Auto" />
            <!--  Column Headers  -->
            <RowDefinition Height="*" />
            <!--  Content List  -->
        </Grid.RowDefinitions>


        <shared:HeaderView Grid.Row="0" />


        <!--  Title and Add Button  -->
        <Grid
            Grid.Row="2"
            Padding="80,10"
            ColumnDefinitions="*,Auto"
            VerticalOptions="Center">

            <Label
                FontAttributes="Bold"
                FontSize="24"
                Text="QL đơn hàng"
                TextColor="#212121"
                VerticalOptions="Center" />

            <SearchBar
                Margin="10,0"
                HorizontalOptions="End"
                Placeholder="Tìm kiếm..."
                SearchCommand="{Binding LoadProductsCommand}"
                Text="{Binding SearchValue}"
                VerticalOptions="Center"
                WidthRequest="200" />

        </Grid>

        <!--  Column headers  -->
        <Grid
            Grid.Row="3"
            Margin="0,10,0,10"
            Padding="80,10"
            ColumnDefinitions="*,*,*,*,*,Auto">
            <Label
                Grid.Column="0"
                FontSize="12"
                Text="Người đặt đơn"
                TextColor="Gray" />

            <Label
                Grid.Column="1"
                FontSize="12"
                HorizontalTextAlignment="Center"
                Text="Email người đặt đơn"
                TextColor="Gray" />
            <Label
                Grid.Column="2"
                FontSize="12"
                HorizontalTextAlignment="Center"
                Text="Trạng thái đơn hàng hiện tại"
                TextColor="Gray" />
            <Label
                Grid.Column="3"
                FontSize="12"
                HorizontalTextAlignment="Center"
                Text="Ngày người dùng đặt đơn"
                TextColor="Gray" />
            <Label
                Grid.Column="4"
                FontSize="12"
                HorizontalTextAlignment="Center"
                Text="Giá trị đơn hàng"
                TextColor="Gray" />
            <Label
                Grid.Column="5"
                FontSize="12"
                HorizontalTextAlignment="End"
                Text="Hành động"
                TextColor="Gray" />
        </Grid>

        <ScrollView Grid.Row="4" Padding="80,0">
            <CollectionView ItemsSource="{Binding Orders}">
                <CollectionView.ItemsLayout>
                    <LinearItemsLayout ItemSpacing="5" Orientation="Vertical" />
                </CollectionView.ItemsLayout>
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:Order">
                        <Frame
                            Margin="0,0,0,10"
                            Padding="8,16"
                            BackgroundColor="#E0E0E0"
                            BorderColor="White"
                            CornerRadius="8"
                            HasShadow="False">
                            <Grid
                                ColumnDefinitions="*,Auto,*,*,*,Auto"
                                RowDefinitions="Auto"
                                VerticalOptions="Center">

                                <!--  Tên người dùng  -->
                                <Label
                                    Grid.Column="0"
                                    FontSize="14"
                                    Text="{Binding UserFullName}"
                                    VerticalOptions="Center" />



                                <!--  Email  -->
                                <Label
                                    Grid.Column="1"
                                    FontSize="14"
                                    HorizontalTextAlignment="Center"
                                    Text="{Binding Email}"
                                    VerticalOptions="Center" />

                                <!--  Trạng thái  -->
                                <Label
                                    Grid.Column="2"
                                    FontSize="14"
                                    HorizontalTextAlignment="Center"
                                    Text="{Binding Status}"
                                    VerticalOptions="Center" />


                                <Label
                                    Grid.Column="3"
                                    FontSize="14"
                                    HorizontalTextAlignment="Center"
                                    Text="{Binding CreatedAt}"
                                    VerticalOptions="Center" />

                                <!--  Tổng giá  -->
                                <Label
                                    Grid.Column="4"
                                    FontSize="14"
                                    HorizontalTextAlignment="Center"
                                    Text="{Binding TotalPrice, StringFormat='{}{0:N0}₫'}"
                                    VerticalOptions="Center" />

                                <!--  Hành động  -->
                                <HorizontalStackLayout
                                    Grid.Column="5"
                                    HorizontalOptions="End"
                                    VerticalOptions="Center">
                                    <Image
                                        HeightRequest="20"
                                        Source="tick_icon.png"
                                        WidthRequest="20">
                                        <Image.GestureRecognizers>
                                            <TapGestureRecognizer Command="{Binding Source={x:Reference OrderManagementPageView}, Path=BindingContext.ConfirmOrderCommand}" CommandParameter="{Binding OrderId}" />
                                        </Image.GestureRecognizers>
                                    </Image>

                                    <Image
                                        Margin="10,0,0,0"
                                        HeightRequest="20"
                                        Source="cross_icon.png"
                                        WidthRequest="20">
                                        <Image.GestureRecognizers>
                                            <TapGestureRecognizer Command="{Binding Source={x:Reference OrderManagementPageView}, Path=BindingContext.CancelOrderCommand}" CommandParameter="{Binding OrderId}" />
                                        </Image.GestureRecognizers>
                                    </Image>
                                </HorizontalStackLayout>
                            </Grid>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </ScrollView>


    </Grid>
</ContentPage>